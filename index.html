<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подготовка к ЕГЭ по русскому</title>
    <style>
        /* ... (предыдущие стили остаются без изменений) ... */
        .question-type {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- ... (предыдущая HTML-разметка без изменений) ... -->

    <script>
        // Типы заданий ЕГЭ по русскому с примерами  
        const questionTypes = {
            1: {
                name: "Орфография",
                description: "В каком слове допущена ошибка в постановке ударения?",
                examples: [
                    {
                        text: "В каком слове допущена ошибка в постановке ударения?",
                        options: [
                            "договОр",
                            "красИвее",
                            "жалюзИ",
                            "звонИт"
                        ],
                        correct: 0,
                        explanation: "Правильный ответ: 'договОр'. Правильное ударение — 'дОговор'."
                    },
                    {
                        text: "В каком слове допущена ошибка в постановке ударения?",
                        options: [
                            "тортЫ",
                            "средствА",
                            "крАны",
                            "нАчав"
                        ],
                        correct: 2,
                        explanation: "Правильный ответ: 'крАны'. Правильное ударение — 'кранЫ'."
                    }
                ]
            },
            2: {
                name: "Пунктуация",
                description: "Расставьте знаки препинания",
                examples: [
                    {
                        text: "Укажите предложение, в котором нужно поставить одну запятую:",
                        options: [
                            "Солнце светило ярко и грело по-летнему.",
                            "Он взял книгу тетрадь и ручку и положил в портфель.",
                            "Ветер то стихал то снова усиливался.",
                            "Дети бегали прыгали и веселились."
                        ],
                        correct: 2,
                        explanation: "Правильный ответ: 'Ветер то стихал то снова усиливался.' Запятая нужна между однородными членами с повторяющимся союзом 'то...то'."
                    }
                ]
            },
            3: {
                name: "Грамматика",
                description: "Найдите грамматическую ошибку",
                examples: [
                    {
                        text: "В каком предложении допущена грамматическая ошибка?",
                        options: [
                            "Он написал письмо своему другу.",
                            "Благодаря стараниям учителя ученики успешно сдали экзамен.",
                            "Все, кто пришел на собрание, получили памятки.",
                            "Читая книгу, мне стало интересно."
                        ],
                        correct: 3,
                        explanation: "Правильный ответ: 'Читая книгу, мне стало интересно.' Ошибка в деепричастном обороте - подлежащее 'мне' не выполняет действие 'читая'."
                    }
                ]
            },
            4: {
                name: "Стилистика",
                description: "Найдите стилистическую ошибку",
                examples: [
                    {
                        text: "В каком предложении допущена стилистическая ошибка?",
                        options: [
                            "Автор раскрывает проблему на конкретных примерах.",
                            "В данном тексте рассматривается актуальная проблема.",
                            "Этот аспект играет большое значение в понимании текста.",
                            "Писатель убедительно доказывает свою точку зрения."
                        ],
                        correct: 2,
                        explanation: "Правильный ответ: 'Этот аспект играет большое значение в понимании текста.' Ошибка в сочетании слов: правильно 'имеет большое значение' или 'играет большую роль'."
                    }
                ]
            },
            5: {
                name: "Понимание текста",
                description: "Ответьте на вопросы по тексту",
                examples: [
                    {
                        text: "Какое утверждение соответствует содержанию текста?",
                        options: [
                            "Автор считает, что современное искусство не имеет ценности.",
                            "В тексте подчеркивается важность сохранения культурного наследия.",
                            "Основная мысль текста - необходимость запрета классического искусства.",
                            "Автор утверждает, что только профессионалы должны оценивать искусство."
                        ],
                        correct: 1,  
                        explanation: "Правильный ответ: 'В тексте подчеркивается важность сохранения культурного наследия.' Это основная мысль текста."
                    }
                ]
            }
        };

        // Состояние приложения  
        let currentUser = null;
        let students = {};
        let userAnswers = {};
        let mistakeStatistics = {}; // Статистика ошибок по типам заданий

        // Дополнительная функция для генерации случайного вопроса с учетом статистики ошибок  
        function generateQuestion() {
            if (!currentUser || !userAnswers[currentUser.email]) {
                // Если нет данных об ошибках, выбираем случайный тип  
                return getRandomQuestion();
            }
            
            // Анализируем статистику ошибок  
            const userStats = mistakeStatistics[currentUser.email] || {};
            let maxMistakesType = null;
            let maxMistakes = 0;
            
            // Находим тип заданий с наибольшим количеством ошибок  
            for (const type in userStats) {
                if (userStats[type].mistakes > maxMistakes) {
                    maxMistakes = userStats[type].mistakes;
                    maxMistakesType = type;
                }
            }
            
            // Если есть тип с ошибками, выбираем вопрос такого типа с вероятностью 70%
            if (maxMistakesType && Math.random() < 0.7) {
                const typeQuestions = questionTypes[maxMistakesType].examples;
                return typeQuestions[Math.floor(Math.random() * typeQuestions.length)];
            }
            
            // Иначе выбираем случайный вопрос  
            return getRandomQuestion();
        }

        function getRandomQuestion() {
            // Выбираем случайный тип задания  
            const typeKeys = Object.keys(questionTypes);
            const randomTypeKey = typeKeys[Math.floor(Math.random() * typeKeys.length)];
            const type = questionTypes[randomTypeKey];
            
            // Выбираем случайный вопрос из этого типа  
            const randomQuestion = type.examples[Math.floor(Math.random() * type.examples.length)];
            
            // Добавляем информацию о типе вопроса  
            randomQuestion.type = randomTypeKey;
            randomQuestion.typeName = type.name;
            
            return randomQuestion;
        }

        // Обновленная функция загрузки вопроса  
        function loadQuestion() {
            const question = generateQuestion();
            
            questionText.innerHTML = `
                <div class="question-type">Тип задания: ${question.typeName} (${questionTypes[question.type].description})</div>
                <div>${question.text}</div>
            `;
            
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.onclick = () => selectOption(index, question.correct, question.type);
                optionsContainer.appendChild(optionElement);
            });

            explanation.style.display = 'none';
            explanation.textContent = question.explanation;
            
            // Сохраняем текущий вопрос для статистики  
            currentQuestion = question;
        }

        // Обновленная функция выбора варианта ответа  
        function selectOption(selectedIndex, correctIndex, questionType) {
            const options = document.querySelectorAll('.option');
            
            options.forEach((option, index) => {
                option.classList.remove('correct', 'incorrect');
                if (index === correctIndex) {
                    option.classList.add('correct');
                } else if (index === selectedIndex && selectedIndex !== correctIndex) {
                    option.classList.add('incorrect');
                }
            });

            explanation.style.display = 'block';

            // Обновляем статистику  
            if (currentUser) {
                if (!userAnswers[currentUser.email]) {
                    userAnswers[currentUser.email] = [];
                }
                
                const isCorrect = selectedIndex === correctIndex;
                userAnswers[currentUser.email].push({
                    questionId: currentQuestion.text,
                    isCorrect,
                    type: questionType  
                });
                
                // Обновляем статистику ошибок по типам  
                if (!mistakeStatistics[currentUser.email]) {
                    mistakeStatistics[currentUser.email] = {};
                }
                
                if (!mistakeStatistics[currentUser.email][questionType]) {
                    mistakeStatistics[currentUser.email][questionType] = { attempts: 0, mistakes: 0 };
                }
                
                const typeStats = mistakeStatistics[currentUser.email][questionType];
                typeStats.attempts++;
                
                if (!isCorrect) {
                    typeStats.mistakes++;
                }
                
                updateStats();
            }

            // Переходим к следующему вопросу через 3 секунды  
            setTimeout(() => {
                loadQuestion();
            }, 3000);
        }

        // Обновленная функция статистики  
        function updateStats() {
            if (!currentUser || currentUser.role !== 'student') return;

            const answers = userAnswers[currentUser.email] || [];
            const correctCount = answers.filter(a => a.isCorrect).length;
            const totalCount = answers.length;
            const accuracy = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;

            // Добавляем статистику по типам заданий  
            let typeStatsHTML = '';
            if (mistakeStatistics[currentUser.email]) {
                typeStatsHTML = '<h4>Статистика по типам заданий:</h4>';
                
                for (const type in mistakeStatistics[currentUser.email]) {
                    const stats = mistakeStatistics[currentUser.email][type];
                    const typeName = questionTypes[type].name;
                    const mistakes = stats.mistakes;
                    const attempts = stats.attempts;
                    const typeAccuracy = attempts > 0 ? Math.round((attempts - mistakes) / attempts * 100) : 0;
                    
                    typeStatsHTML += `
                        <p><strong>${typeName}:</strong> ${attempts - mistakes}/${attempts} (${typeAccuracy}%)</p>
                    `;
                }
            }

            stats.innerHTML = `
                <h3>Общая статистика</h3>
                <p>Всего отвечено: ${totalCount}</p>
                <p>Правильных ответов: ${correctCount}</p>
                <p>Точность: ${accuracy}%</p>
                ${typeStatsHTML}
            `;
        }

        // ... (остальной код остается без изменений) ...

        let currentQuestion = {}; // Текущий вопрос

        window.onload = function() {
            loadQuestion(); // Загружаем первый вопрос  
            updateUI();
        };
    </script>
</body>
</html>
